/* ===== Cosmo â€” Composer (scoped, simplified, robust) ===== */
/* 2) Primary composer container (stable wrapper inside the form) */
form[data-type="unified-composer"] .bg-token-bg-primary {
  background:
    linear-gradient(180deg, color-mix(in oklab, var(--cosmo-accent-1) 6%, transparent),
                           color-mix(in oklab, var(--cosmo-accent-2) 2%, transparent)),
    color-mix(in oklab, var(--cosmo-card) 78%, transparent) !important;
  border: 1px solid var(--cosmo-border) !important;
  backdrop-filter: blur(var(--cosmo-blur-strength)) saturate(160%) contrast(var(--cosmo-contrast-boost)) brightness(1.12) !important;
  -webkit-backdrop-filter: blur(var(--cosmo-blur-strength)) saturate(160%) contrast(var(--cosmo-contrast-boost)) brightness(1.12) !important; /* Safari */
  border-radius: 24px !important;
  box-shadow: var(--cosmo-glow-soft);
  position: relative;
  overflow: hidden;
  isolation: isolate;
  transition: border-color .18s ease, box-shadow .18s ease, background-color .18s ease;
}

/* Layered gloss + liquid highlight */
form[data-type="unified-composer"] .bg-token-bg-primary::before {
  content: ""; position: absolute; inset: 0; border-radius: inherit; pointer-events: none;
  background:
    /* soft specular at top-left */
    radial-gradient(120% 70% at 8% -20%, rgba(255,255,255,.05), transparent 45%),
    /* faint caustic at bottom-right */
    radial-gradient(120% 70% at 100% 120%, rgba(255,255,255,.03), transparent 55%);
  background-blend-mode: soft-light;
  opacity: .24; /* further softened to avoid wet glare */
}

/* Inner strokes for glass edge definition */
form[data-type="unified-composer"] .bg-token-bg-primary::after {
  content: ""; position: absolute; inset: 0; border-radius: inherit; pointer-events: none;
  box-shadow:
    /* (removed) inset 0 1px 0 rgba(255,255,255,.12), */
    inset 0 -1px 0 rgba(255,255,255,.05);
  opacity: .5; /* was .6 */
}

/* Reduce Transparency accessibility: darken/tighten surface, lower blur, boost contrast */
html[data-cosmo-reduce-transparency] form[data-type="unified-composer"] .bg-token-bg-primary {
  background: color-mix(in oklab, var(--cosmo-card) 92%, black 8%) !important;
  backdrop-filter: blur(calc(var(--cosmo-blur-strength) - 6px)) saturate(140%) contrast(calc(var(--cosmo-contrast-boost) + .06)) brightness(1.06) !important;
  -webkit-backdrop-filter: blur(calc(var(--cosmo-blur-strength) - 6px)) saturate(140%) contrast(calc(var(--cosmo-contrast-boost) + .06)) brightness(1.06) !important;
  border-color: color-mix(in oklab, var(--cosmo-border) 85%, transparent) !important;
}

/* Fallback for browsers without backdrop-filter: keep readable solid tint */
@supports not ((backdrop-filter: blur(1px))) {
  form[data-type="unified-composer"] .bg-token-bg-primary {
    background: color-mix(in oklab, var(--cosmo-card) 88%, transparent) !important;
  }
}

/* OPTIONAL: Ultra-refined Liquid Glass micro-rim (uncomment to enable)
form[data-type="unified-composer"] .bg-token-bg-primary::after {
  box-shadow:
    inset 0 0 0 1px color-mix(in oklab, var(--cosmo-border) 70%, transparent),
    inset 0 -1px 0 rgba(255,255,255,.05);
  opacity: .45;
}
*/

/* Subtle interactive lift on hover (respects hover toggle) */
html:not([data-cosmo-no-chatbar-hover]) form[data-type="unified-composer"] .bg-token-bg-primary:hover {
  border-color: color-mix(in oklab, var(--cosmo-accent-2) 28%, var(--cosmo-border));
  box-shadow: var(--cosmo-glow-soft), 0 0 0 1px color-mix(in oklab, var(--cosmo-accent-2) 14%, transparent);
}
html:not([data-cosmo-no-chatbar-hover]) form[data-type="unified-composer"] .bg-token-bg-primary:hover::before { opacity: .8; }

/* 4) Secondary buttons (+, mic, etc.) inside the composer */
form[data-type="unified-composer"] button[data-testid="composer-plus-btn"],
form[data-type="unified-composer"] button[data-testid="composer-speech-button"] {
  background:
    linear-gradient(135deg, color-mix(in oklab, var(--cosmo-accent-1) 8%, transparent),
                            color-mix(in oklab, var(--cosmo-accent-2) 4%, transparent)),
    color-mix(in oklab, var(--cosmo-card) 72%, transparent) !important;
  border: 1px solid color-mix(in oklab, var(--cosmo-border) 85%, transparent) !important;
  border-radius: 9999px !important;
  box-shadow: 
    0 1px 2px rgba(0,0,0,.15),
    0 2px 6px rgba(0,0,0,.12),
    0 4px 12px rgba(0,0,0,.08),
    inset 0 -1px 2px rgba(0,0,0,.2),
    inset 0 1px 1px rgba(255,255,255,.1),
    var(--cosmo-glow-soft);
  position: relative;
  overflow: hidden;
  isolation: isolate;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  line-height: 0;
  width: 40px; height: 40px;
  min-width: 40px; min-height: 40px;
  backdrop-filter: blur(var(--cosmo-blur-strength)) saturate(150%) contrast(1.08) brightness(1.08) !important;
  -webkit-backdrop-filter: blur(var(--cosmo-blur-strength)) saturate(150%) contrast(1.08) brightness(1.08) !important;
  background-clip: padding-box;
  clip-path: inset(0 round 9999px);
  transform: translateZ(0);
  will-change: transform;
  transition: background-color .18s ease, box-shadow .18s ease, transform .12s ease;
}
form[data-type="unified-composer"] button[data-testid="composer-plus-btn"]::before,
form[data-type="unified-composer"] button[data-testid="composer-speech-button"]::before {
  content: ""; position: absolute; inset: 0; border-radius: inherit; pointer-events: none;
  background: 
    linear-gradient(180deg, rgba(255,255,255,.08) 0%, rgba(255,255,255,.02) 50%, rgba(0,0,0,.04) 100%);
  opacity: .6;
}

/* Inner ring for buttons */
form[data-type="unified-composer"] button[data-testid="composer-plus-btn"]::after,
form[data-type="unified-composer"] button[data-testid="composer-speech-button"]::after {
  content: ""; position: absolute; inset: 0; border-radius: inherit; pointer-events: none;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.15),
    inset 0 0 0 1px color-mix(in oklab, var(--cosmo-border) 60%, transparent);
  opacity: .7;
}

/* Button hover affordance (respects hover toggle) */
html:not([data-cosmo-no-chatbar-hover]) form[data-type="unified-composer"] button[data-testid="composer-plus-btn"]:hover,
html:not([data-cosmo-no-chatbar-hover]) form[data-type="unified-composer"] button[data-testid="composer-speech-button"]:hover {
  border-color: color-mix(in oklab, var(--cosmo-accent-2) 28%, var(--cosmo-border));
  box-shadow: 
    0 2px 4px rgba(0,0,0,.2),
    0 4px 8px rgba(0,0,0,.15),
    0 6px 16px rgba(0,0,0,.1),
    inset 0 -1px 2px rgba(0,0,0,.2),
    inset 0 1px 1px rgba(255,255,255,.12),
    var(--cosmo-glow-soft),
    0 0 0 1px color-mix(in oklab, var(--cosmo-accent-2) 14%, transparent);
  transform: translateY(-2px);
}
form[data-type="unified-composer"] button[data-testid="composer-plus-btn"]:active,
form[data-type="unified-composer"] button[data-testid="composer-speech-button"]:active {
  transform: translateY(0);
  box-shadow: 
    0 1px 1px rgba(0,0,0,.2),
    inset 0 1px 3px rgba(0,0,0,.3),
    inset 0 -1px 1px rgba(255,255,255,.05),
    var(--cosmo-glow-soft);
}

/* 5) Hover / focus treatment (using :focus-within; respects toggles) */

/* Focus highlight (unless disabled) */
html:not([data-cosmo-no-chatbar-highlight]) form[data-type="unified-composer"] .bg-token-bg-primary:focus-within {
  box-shadow: var(--cosmo-glow-soft), 0 0 0 2px color-mix(in oklab, var(--cosmo-accent-2) 30%, transparent);
}

/* When highlight is disabled, keep a consistent base glow */
html[data-cosmo-no-chatbar-highlight] form[data-type="unified-composer"] .bg-token-bg-primary:focus-within {
  box-shadow: var(--cosmo-glow-soft);
}
