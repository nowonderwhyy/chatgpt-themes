/* -------------- Page canvas -------------- */
/* Top-level HTML is marked with class 'dark' and data-chat-theme â€” we stay compatible. */
html.dark { background: var(--cosmo-bg) !important; color: var(--cosmo-text); }

/* Prevent blending artefacts from bubbling up the stacking context */
html { isolation: isolate; }

/* Subtle canvas vignette for depth */
html.dark::after{
    content: ""; position: fixed; inset: 0; pointer-events: none;
    background:
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128" viewBox="0 0 128 128"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.65" numOctaves="2" stitchTiles="stitch"/></filter><rect width="128" height="128" filter="url(%23n)" fill="black" opacity="0.016"/></svg>'),
        radial-gradient(90% 70% at 50% 120%, rgba(0,0,0,.24), transparent 60%),
        radial-gradient(50% 40% at 50% -10%, rgba(255,255,255,.025), transparent 60%);
    mix-blend-mode: normal;
    background-blend-mode: soft-light, normal, normal;
    opacity: var(--cosmo-grain-opacity);
    background-size: var(--cosmo-grain-scale) var(--cosmo-grain-scale), auto, auto;
}

/* Background glass plane for readability (subtle, behind entire chat area) */
#main::before{
    content:"";
    position: absolute; /* fill the chat container */
    inset: 0;
    border-radius: 0;
    background: color-mix(in oklab, var(--cosmo-card) 65%, transparent);
    backdrop-filter: blur(calc(var(--cosmo-blur-strength) - 4px)) saturate(130%) contrast(1.04);
    -webkit-backdrop-filter: blur(calc(var(--cosmo-blur-strength) - 4px)) saturate(130%) contrast(1.04);
    box-shadow: 0 8px var(--cosmo-glow-spread) rgba(0,0,0,.25);
    pointer-events: none;
    contain: paint;
    z-index: 0;
}
#thread, #main { position: relative; z-index: 1; }

/* Remove built-in rounded chrome so the Cosmo canvas can fill every corner */
#main,
#thread,
[data-testid="stretched-body"],
main[role="main"],
#__next,
html,
body {
    border-radius: 0 !important;
}

/* ----- Force the site canvas to use our theme background ----- */
html, body { background: var(--cosmo-bg) !important; }

/* Neutralize site wrappers so our BG shows through */
#__next,
main[role="main"],
#main,
#thread,
[data-testid="stretched-body"],
.bg-token-main-surface-primary,
.bg-token-main-surface-secondary,
.bg-token-main-surface-tertiary {
    background: transparent !important;
}
/* Thread scroller itself should be transparent */
#thread > .composer-parent > div > div[class*="overflow-y-auto"],
#thread [class*="overflow-y-auto"] {
    background: transparent !important;
}
/* Additional thread coverage: neutralize token backgrounds in message view */
#main [class*="bg-token-bg-"],
#main [class*="bg-token-main-surface-"],
#main [class*="bg-token-surface-"],
#thread [class*="bg-token-bg-"],
#thread [class*="bg-token-main-surface-"],
#thread [class*="bg-token-surface-"] {
    background: transparent !important;
}
#main .shadow-short, #thread .shadow-short { box-shadow: none !important; }

/* Bottom container beneath composer should not paint a surface */
#thread-bottom-container,
#thread-bottom-container::before,
#thread-bottom-container::after {
    background: transparent !important;
    box-shadow: none !important;
    border: none !important;
}

/* Dim top/bottom zones so gradients don't compete with header/composer */
html.dark::before{
    content:"";
    position: fixed; inset: 0; pointer-events: none; z-index: 0;
    background:
        linear-gradient(to bottom, rgba(0,0,0,.16), transparent 160px),
        linear-gradient(to top, rgba(0,0,0,.12), transparent 160px);
    mix-blend-mode: normal;
}

/* ============= Burrito Theme: Blurred Photo Background ============= */
/* Ensure background image is properly sized and positioned */
html.dark[data-cosmo-theme="burrito"],
html.dark[data-cosmo-theme="burrito"] body {
    background-size: cover, cover, cover, cover !important;
    background-position: center !important;
    background-attachment: fixed !important;
    background-repeat: no-repeat !important;
    background-blend-mode: var(--burrito-overlay-blends);
}

/* Create heavily blurred and saturated overlay behind everything using body::before */
html.dark[data-cosmo-theme="burrito"] body::before {
    content: "";
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: -1;
    background-image: var(--burrito-overlay-veil), var(--burrito-bg-1920);
    background-size: cover, cover, cover, cover;
    background-position: center;
    background-attachment: fixed;
    background-repeat: no-repeat;
    background-blend-mode: var(--burrito-overlay-blends);
    filter: blur(64px) saturate(168%) brightness(1.08);
    opacity: 0.88;
    transform: scale(1.04);
}

/* Balanced grain overlay for texture while maintaining legibility */
html.dark[data-cosmo-theme="burrito"]::before {
    background:
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128" viewBox="0 0 128 128"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.65" numOctaves="2" stitchTiles="stitch"/></filter><rect width="128" height="128" filter="url(%23n)" fill="black" opacity="0.016"/></svg>'),
        radial-gradient(88% 70% at 18% 0%, rgba(255, 126, 228, .18), transparent 72%),
        radial-gradient(100% 74% at 82% 120%, rgba(110, 214, 255, .14), transparent 68%),
        linear-gradient(to bottom, rgba(8, 2, 22, .32), transparent 220px),
        linear-gradient(to top, rgba(8, 2, 22, .28), transparent 200px);
}

/* Responsive image loading based on screen size */
@media (max-width: 768px) {
    html.dark[data-cosmo-theme="burrito"],
    html.dark[data-cosmo-theme="burrito"] body {
        background-image: var(--burrito-overlay-veil), var(--burrito-bg-640) !important;
        background-size: cover, cover, cover, cover !important;
        background-repeat: no-repeat !important;
        background-blend-mode: var(--burrito-overlay-blends);
    }
    html.dark[data-cosmo-theme="burrito"] body::before {
        background-image: var(--burrito-overlay-veil), var(--burrito-bg-640);
        background-size: cover, cover, cover, cover;
        background-repeat: no-repeat;
        background-blend-mode: var(--burrito-overlay-blends);
    }
}

@media (min-width: 769px) and (max-width: 1440px) {
    html.dark[data-cosmo-theme="burrito"],
    html.dark[data-cosmo-theme="burrito"] body {
        background-image: var(--burrito-overlay-veil), var(--burrito-bg-1280) !important;
        background-size: cover, cover, cover, cover !important;
        background-repeat: no-repeat !important;
        background-blend-mode: var(--burrito-overlay-blends);
    }
    html.dark[data-cosmo-theme="burrito"] body::before {
        background-image: var(--burrito-overlay-veil), var(--burrito-bg-1280);
        background-size: cover, cover, cover, cover;
        background-repeat: no-repeat;
        background-blend-mode: var(--burrito-overlay-blends);
    }
}

